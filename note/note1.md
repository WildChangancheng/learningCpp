# C语言复习

## 1 基础

### 1.1 关于C语言

1972年，贝尔实验室的Dennis Ritch和Ken Thompson在开发UNIX操作系统时设计了C语言。

总体上来说，C语言融合了计算机科学理论和实践的控制特性，面向过程，是高效的语言并且拥有不错的可移植性，强大而灵活。

### 1.2 编写与编译

使用C语言工作实，整体可以分为：

1. 定义程序的目标
2. 设计程序
3. 编写代码
4. 编译
5. 运行程序
6. 测试和调试程序
7. 维护和修改程序

七步。编译这一步是把源代码转换成可执行代码的程序的步骤。不同计算机使用不同的机器语言方案，C编译器负责吧C语言代码翻译成特定的机器语言。

总体上来说，多思考多规划再动手编写代码总是好的。要养成先动脑后动手的习惯。

大多数时候，我们要求一个c语言文件的基本名basename合法、扩展名extension为.c或者.h。有些特殊的系统，比如MS-DOS要求basename不超过8个char，有些UNIX系统则限制整个文件名（包括extension）都不超过14个char。

当然，现在的Linux、Windows和MacOS都允许使用长文件名。

C语言编译的基本过程是，编译器把源代码转换成中间代码后，用链接器把中间代码和其它代码合并，最终生成可执行文件。

这里用到了分而治之的思想，所以也可以独立编译单独的模块，稍后再用链接器合并已经编译好的模块或者把已经编写好的程序和预编译的库代码合并。

中间文件有很多种形式，我们在这里探讨最普遍的一种形式，也就是

- 把源代码转换成机器语言代码并把结果放在目标代码文件中。
- 然后补全原本缺失的启动代码startup code。启动代码充当程序和操作系统之间的接口。例如，可以在MS Windows或Linux系统下运行IBM PC兼容机，因为使用的硬件相同，所以目标代码相同。但是Linux和Windows系统使用的启动代码不同，因为系统处理程序的方式不同。
- 现在目标代码还缺少库函数，链接器会将目标代码、标准启动代码和库代码和拽到一个文件里，也就是可执行文件。对于库代码，链接器只会把程序中需要用到的库函数代码提取出来。

GNU项目开始于1987年，是一个开发大量免费UNIX软件的集合，其中包括GCC C语言编译器。用gcc命令就可以调用GCC编译器，许多使用GCC的系统都是用cc作为gcc的别称。

此外，LLVM项目成为cc的另一个替代品，该项目是与编译器相关的开源软件集合，其中Clang编译器可以通过clang调用。2012年后Clang几位FreeBSD的默认C语言编译器。

gcc可以通过`-std=c99`之类的参数调用不同的C语言标准。

Windows系统上Cygwin尽可能模拟Linux命令行环境，进行编译、MinGW在Windows的命令提示模式中运行。Borland的C++编译器也是一个选择，支持到C90.

C编译器生成的中间目标代码文件的扩展名通常是.obj。不同于Unix编译器，这些编译器完成编译后通常会保留中间文件（比如.asm扩展名的汇编语言文件）。

另外，集成开发环境IDE也是一个不错的选择。

在程序执行完毕后，执行程序的窗口立即消
失。如果不希望出现这种情况，可以让程序暂停，直到按下Enter键，窗口
才消失。要实现这种效果，可以在程序的最后（return这行代码之前）添加
下面一行代码：
getchar();
该行读取一次键的按下，所以程序在用户按下Enter键之前会暂停。有
时根据程序的需要，可能还需要一个击键等待。这种情况下，必须用两次
getchar()：
getchar();
getchar();

## 1.3 再写个Hello, world吧

```c
// chapter1 eg1.c
#include <stdio.h>

int main() {
    printf("Hello, world\n");
    return 0;
}
```

\#include 指令和头文件

这是程序的预处理器指令preprocessor directive，头文件包含编译器创建最终可执行程序要用到的信息，比如某些常量或者函数名之类的东西。总之，头文件帮助编译器把程序正确组合在一起。 ANSI/ISO规定了C语言编译器必须提供的头文件。

C语言中，一定需要有声明declaration才可以使用某一个变量，告诉编译器会出现什么变量名，这个变量是什么类型。标识符（变量、函数或者其他实体的名称）也有一定的法则。

旧版的C语言要求变量声明必须在块的顶部，其他语句不能在任何声明的前面。C99和C11以后则变得灵活了很多。不过，首次使用变量之前一定要声明。C99和C11后允许更长的变量名，但是不要超过63个字符（另外，外部标识符只允许使用31个字符）

合法的标识符可以包括大小写字母、数字和下划线，其中数字不能用作开头。另外，操作系统和C库经常使用一个或两个下划线开始的标识符，所以自己的程序中尽量不要这么用比较好。标准标签都以一个或两个下划线字符开始，这样的标识符都是保留着的。另外，C语言的标识符是大小写敏感的。

## 1.4 定义一个函数

在不准备一开始写出整个程序的时候，可以先写出函数原型（函数原型相当于声明函数，要加`分号;`完成整个语句。函数原型在C90加入，导致旧的编译器可能无法识别。函数原型是一种生命形式，告诉编译器正在使用某函数，所以函数原型也叫function declaration。

C语言标准其实建议腰围程序中用到的所有函数都提供函数原型，标准include文件为标准库函数提供函数原型。

试试写一个bmi的计算程序。

```c
// chapter2 eg2.c
#include <stdio.h>

float bmi_caculator(float height, float weight) {
    return weight / height / height;
}
int main(void) {
    float result = bmi_caculator(1.7, 65);
    printf("%f\n", result);
    return 0;
}
```

## 1.5 一些输入输出

可以阅读<https://c.biancheng.net/view/cttgz7l.html>这个网页，会有详尽的讲解。

缓冲区类似于一个队列结构，他会记录你在控制台中输入的所有键盘响应（包括空格和回车等），既然是队列，那就满足FIFO的顺序（First In， Firs Out，所谓的先入先出）。

getchar()只能读出字符型，但形式比较简单，因此常用来清洗缓冲区。接下来就是scanf()函数，它分为两部分scanf("控制符部分"，&参数列表)：第一部分为控制符部分，这里和printf的控制符部分是相同的，例如你想获取一个整型数据就要使用“%d”、获取一个字符数据便使用“%c”。


