# C语言复习

## 1 基础

### 1.1 关于C语言

1972年，贝尔实验室的Dennis Ritch和Ken Thompson在开发UNIX操作系统时设计了C语言。

总体上来说，C语言融合了计算机科学理论和实践的控制特性，面向过程，是高效的语言并且拥有不错的可移植性，强大而灵活。

### 1.2 编写与编译

使用C语言工作实，整体可以分为：

1. 定义程序的目标
2. 设计程序
3. 编写代码
4. 编译
5. 运行程序
6. 测试和调试程序
7. 维护和修改程序

七步。编译这一步是把源代码转换成可执行代码的程序的步骤。不同计算机使用不同的机器语言方案，C编译器负责吧C语言代码翻译成特定的机器语言。

总体上来说，多思考多规划再动手编写代码总是好的。要养成先动脑后动手的习惯。

大多数时候，我们要求一个c语言文件的基本名basename合法、扩展名extension为.c或者.h。有些特殊的系统，比如MS-DOS要求basename不超过8个char，有些UNIX系统则限制整个文件名（包括extension）都不超过14个char。

当然，现在的Linux、Windows和MacOS都允许使用长文件名。

C语言编译的基本过程是，编译器把源代码转换成中间代码后，用链接器把中间代码和其它代码合并，最终生成可执行文件。

这里用到了分而治之的思想，所以也可以独立编译单独的模块，稍后再用链接器合并已经编译好的模块或者把已经编写好的程序和预编译的库代码合并。

中间文件有很多种形式，我们在这里探讨最普遍的一种形式，也就是

- 把源代码转换成机器语言代码并把结果放在目标代码文件中。
- 然后补全原本缺失的启动代码startup code。启动代码充当程序和操作系统之间的接口。例如，可以在MS Windows或Linux系统下运行IBM PC兼容机，因为使用的硬件相同，所以目标代码相同。但是Linux和Windows系统使用的启动代码不同，因为系统处理程序的方式不同。
- 现在目标代码还缺少库函数，链接器会将目标代码、标准启动代码和库代码和拽到一个文件里，也就是可执行文件。对于库代码，链接器只会把程序中需要用到的库函数代码提取出来。

GNU项目开始于1987年，是一个开发大量免费UNIX软件的集合，其中包括GCC C语言编译器。用gcc命令就可以调用GCC编译器，许多使用GCC的系统都是用cc作为gcc的别称。

此外，LLVM项目成为cc的另一个替代品，该项目是与编译器相关的开源软件集合，其中Clang编译器可以通过clang调用。2012年后Clang几位FreeBSD的默认C语言编译器。

gcc可以通过`-std=c99`之类的参数调用不同的C语言标准。

Windows系统上Cygwin尽可能模拟Linux命令行环境，进行编译、MinGW在Windows的命令提示模式中运行。Borland的C++编译器也是一个选择，支持到C90.

C编译器生成的中间目标代码文件的扩展名通常是.obj。不同于Unix编译器，这些编译器完成编译后通常会保留中间文件（比如.asm扩展名的汇编语言文件）。

另外，集成开发环境IDE也是一个不错的选择。

在程序执行完毕后，执行程序的窗口立即消
失。如果不希望出现这种情况，可以让程序暂停，直到按下Enter键，窗口
才消失。要实现这种效果，可以在程序的最后（return这行代码之前）添加
下面一行代码：
getchar();
该行读取一次键的按下，所以程序在用户按下Enter键之前会暂停。有
时根据程序的需要，可能还需要一个击键等待。这种情况下，必须用两次
getchar()：
getchar();
getchar();

## 1.3 再写个Hello, world吧

```c
// chapter1 eg1.c
#include <stdio.h>

int main() {
    printf("Hello, world\n");
    return 0;
}
```

\#include 指令和头文件

这是程序的预处理器指令preprocessor directive，头文件包含编译器创建最终可执行程序要用到的信息，比如某些常量或者函数名之类的东西。总之，头文件帮助编译器把程序正确组合在一起。 ANSI/ISO规定了C语言编译器必须提供的头文件。

C语言中，一定需要有声明declaration才可以使用某一个变量，告诉编译器会出现什么变量名，这个变量是什么类型。标识符（变量、函数或者其他实体的名称）也有一定的法则。

旧版的C语言要求变量声明必须在块的顶部，其他语句不能在任何声明的前面。C99和C11以后则变得灵活了很多。不过，首次使用变量之前一定要声明。C99和C11后允许更长的变量名，但是不要超过63个字符（另外，外部标识符只允许使用31个字符）

合法的标识符可以包括大小写字母、数字和下划线，其中数字不能用作开头。另外，操作系统和C库经常使用一个或两个下划线开始的标识符，所以自己的程序中尽量不要这么用比较好。标准标签都以一个或两个下划线字符开始，这样的标识符都是保留着的。另外，C语言的标识符是大小写敏感的。

## 1.4 定义一个函数

在不准备一开始写出整个程序的时候，可以先写出函数原型（函数原型相当于声明函数，要加`分号;`完成整个语句。函数原型在C90加入，导致旧的编译器可能无法识别。函数原型是一种生命形式，告诉编译器正在使用某函数，所以函数原型也叫function declaration。

C语言标准其实建议腰围程序中用到的所有函数都提供函数原型，标准include文件为标准库函数提供函数原型。

试试写一个bmi的计算程序。

```c
// chapter2 eg2.c
#include <stdio.h>

float bmi_caculator(float height, float weight) {
    return weight / height / height;
}
int main(void) {
    float result = bmi_caculator(1.7, 65);
    printf("%f\n", result);
    return 0;
}
```

## 1.5 一些输入输出

可以阅读<https://c.biancheng.net/view/cttgz7l.html>这个网页，会有详尽的讲解。

缓冲区类似于一个队列结构，他会记录你在控制台中输入的所有键盘响应（包括空格和回车等），既然是队列，那就满足FIFO的顺序（First In， Firs Out，所谓的先入先出）。

getchar()只能读出字符型，但形式比较简单，因此常用来清洗缓冲区。接下来就是scanf()函数，它分为两部分scanf("控制符部分"，&参数列表)：第一部分为控制符部分，这里和printf的控制符部分是相同的，例如你想获取一个整型数据就要使用“%d”、获取一个字符数据便使用“%c”。

scanf遇到第一个空白（比如空格、制表符、换行符）就会停止输入。所以一般而言，scanf只会读取字符串中的一个单词，而不是一整句。C语言还有专门的输入函数，比如fgets，用于读取字符串。这些会在后面体积。
## 1.6 变量和常量数据

有些数据类型在程序使用之前已经预先设定好了，在整个程序的运行过程中没有变化，这些称为常量（constant）。其他数据类型在程序运行期间可能会改变或被赋值，这些称为变量（variable）。在示例程序中，weight 是一个变量，14.5833 是一个常量。

对于字面量，C语言编译器一般直接通过用户书写的形式进行类型识别，例如42是整形，42.100是浮点型。但是，对变量而言，要在声明时指定其类型（也就是说需要进行声明）。

对于整型而言，C90新增了signed关键字用于提供基本整数类型。\_Bool类型表示布尔值true或false。\_complex和\Imaginary表示复数和虚数。通过这些关键字创建的类型可以按计算机的存储方式氛围整数类型和浮点数类型。

bit是最小的存储单元、在此之上有更大的byte类型（对于几乎所有机器，我们都规定1Byte=8bits）、word是涉及计算机时给定的自然存储单位。计算机的字越大，数据转移就越快，允许访问的内存也就越多。最初的计算机1word只有1bit，而现在已经在用64位计算机了。

再复习一下，计算机中的数字是按补码存储的，对于负数都要取反+1，从而形成类似环的结构。

### 整数与浮点数

___

浮点数与数学中实数的概念差不多。2.75、3.16E7、7.00 和 2e-8 都是浮点数。计算机把浮点数分成小
数部分和指数部分来表示，而且分开储存这两部分。因此，虽然7.00和7在数值上相同，但是它们的储存方式不同。在十进制下，可以把7.0写成0.7E1。这里，0.7是小数部分，1是指数部分。

声明declaration是指出类型和变量名；初始化initialize是赋初识值。C语言的初始化可以在声明的时候完成，只需要再变量名后面直接加上赋值运算符和值就好。

C语言中0x或0X前缀表示十六进制值、0表示八进制、0b和0B表示二进制。

再字面量结尾加上l或者L就可以强制使用long类型存储哪怕很小的数（最好用大写的L，因为小写的l和1很像）

### char

通常来说，65表示'A'。

转义字符\a警报、\b退格、\f换页、\n换行、\r回车（回到最初）、\t水平制表符、\v垂直制表符、\0oo转换八进制、\xhh转换十六进制

### _Bool类型

C99中才正式加入再C语言中，用于表示布尔类型，也就是逻辑值true和false，因为C语言用1表示true，0表示false。所以_Bool类型实际上也是一种整数类型，但原则上它紧紧表示占用1bit存储空间，因为对0和1而言，1位的存储空间已经足够了。

### 关于可移植类型

C语言为现有类型创建了更多类型名。这些新的类型名定义在stdint.h头文件中。

### 浮点类型

这里比较特殊，浮点类型的表示方法类似于科学计数法，可以表示非常大和非常小的数。程序将科学计数法转换成指数计数法。

float有至少6位有效数字。通常，系统储存一个浮点数要占用32位，其中8位用于表示指数的值和符号，剩下24位用于表示非指数部分（也叫尾数或有效数）及其符号。

更进一步地，C语言还有double类型，也就是双精度浮点型，至少能表示10位有效数字，通常会占用64位。不同系统的处理策略不同，但无论什么系统，double类型通常都有至少13位有效数字，精准度更高。

此外，还有long double，从而保证更高的精度要求。

___

浮点型字面量也可以写成-1.56E+12之类的样子，默认情况下，编译器假定浮点型常量是double类型的精度。

___

打印long double类型要使用%Lf、%Le或%La。

有另一个特殊的浮点值NaN（not a number的缩写）

### 复数和虚数

也许你会感觉_Complex和_Imaginary很难xp，那就导入complex.h头文件就好了。为什么要专门定义一个头文件？就是为了不和很多程序员自己设计的程序不冲突。

### sizeof

sizeof是C语言的内置运算符，以字节为单位给出指定类型的大小。C99和C11提供%zd转换说明匹配sizeof的返回类型。一些不支持C99和C11的编译器可用%u或%lu代替%zd。

## 1.7 关于赋值等

C语言的类型匹配非常不严格，甚至允许二次初始化。把一个类型的数值初始化给不同类型的变量时，编译器会把值转换成与
变量匹配的类型，这也许会导致信息的丢失。

编译器把浮点数转换成整数时，会直接丢弃（截断）小数部分，而不进行四舍五入、用float接收一个比较精细的数可能会损失一定精度。

许多程序员和公司内部都有系统化的命名约定，在变量名中体现其类型。如用 _前缀表示 int类型，us_前缀表示unsigned short类型

## 1.8 关于刷新缓存区

printf()何时把输出发送到屏幕上？最初，printf()语句把输出发送到一个叫作缓冲区（buffer）的中间存储区域，然后缓冲区中的内容再不断被发送到屏幕上。C 标准明确规定在缓存区充满或者遇到换行字符、需要输入的时候刷新缓存区。

旧式编译器遇到scanf()也不会强行刷新缓冲区，这就需要在程序中手动刷新缓冲区。

## 2 字符串和格式化输入/输出

### 2.1 char类型数组和null字符

C语言没有专门开发类似Python的str之类的字符串类型。字符串被存储在char类型的数组中。数组由连续的存储单元组成，字符串中的字符被储存在相邻的存储单元中，每个单元储存一个字符。最终用一个空字符null character（也就是\0）结尾，C语言用它标记字符串的结束。空字符不是数字0，而是专门的\0，是一个非打印字符，ASCII码点是0。C语言的字符串一定是用null character结尾，所以实际上数组的容量必须至少比带存储字符串中的字符数量多1。例如一个40Bytes的字符串实际上最多只能存储39个char。

数组是同类型数据元素的有序序列。而字符串实际上是特殊类型的数组，如果试着用type hint写的话，也许就是list[str]，当然用C语言来说是array[char]。

接下来试着使用字符串：

第二章的eg1我们试试：

```c
# chapter2 eg1.c
#include <stdio.h>
#define PRAISE "You are an extraordinary being."

int main(void) {
    char name[40];
    printf("Wht's your name? Type in here:");
    scanf("%s", name);
    printf("Hello, %s. %s\n", name, PRAISE);
    return 0;
}
```

在这里咱们就创建了一个很大的内存空间并往里面写入了一个name，用%s格式化输出了一个字符串。你不用亲自把空字符放入字符串末尾，scanf()在读取输入时就已完成了这项工作。同样的，也不用再字符串常量PRAISE结尾添加\0，因为编译器同样完成了这项工作。对于双引号包裹的内容，编译器会自动理解为字符串并加上这些东西的。

### 2.2 strlen和const

strlen函数可以用来计算字符串中的字符长度。strlen包含在头文件string.h中。

用C预处理器指令#define和const修饰符可以创建常量。
